(function(r,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r.Trickling={}))})(this,function(r){"use strict";var O=Object.defineProperty;var E=(r,n,u)=>n in r?O(r,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[n]=u;var l=(r,n,u)=>(E(r,typeof n!="symbol"?n+"":n,u),u);function n(s,t,e){return s<t?t:s>e?e:s}function u(s){return((-1+s)*100).toFixed(4)}function h(s,t){const c=(s.getAttribute("style")||"").split(";").filter(a=>!!a.trim()).reduce((a,m)=>{const v=m.split(":").map(N=>N.trim()),P=v[0],w=v[1];return a[P]=w,a},{}),o=Object.assign(c,t),d=Object.keys(o).filter(a=>!!a.trim()).reduce((a,m)=>(a+=`${m}: ${o[m]};`,a),"");s.setAttribute("style",d)}const k=(()=>{const s=[];function t(){const e=s.shift();e&&e(t)}return function(e){s.push(e),s.length==1&&t()}})();function y(s,t){return(typeof s=="string"?s:g(s)).indexOf(" "+t+" ")>=0}function S(s,t){const e=g(s),i=e+t;y(e,t)||(s.className=i.substring(1))}function b(s,t){const e=g(s);if(!y(s,t))return;const i=e.replace(" "+t+" "," ");s.className=i.substring(1,i.length-1)}function g(s){return(" "+(s&&s.className||"")+" ").replace(/\s+/gi," ")}function T(s){s&&s.parentNode&&s.parentNode.removeChild(s)}const p=class{constructor(t){l(this,"template",`
    <div class="bar" role="bar">
      <div class="peg"></div>
    </div>
    <div class="spinner" role="spinner">
      <div class="spinner-icon"></div>
    </div>`);l(this,"barSelector",'[role="bar"]');l(this,"spinnerSelector",'[role="spinner"]');l(this,"busyFlagClassName","trickling-busy");l(this,"customParentClassName","trickling-custom-parent");l(this,"status",null);l(this,"progressOffsetWidth",0);l(this,"positionUsing","");l(this,"options",{speed:200,wrapperSelectorId:"trickling",appendTo:"body",minimum:.08,easing:"ease",showSpinner:!0,trickleSpeed:1e3,trickle:!0});this.options=Object.assign(this.options,t),this.status=null}render(t){if(this.isRendered())return document.getElementById(this.options.wrapperSelectorId);S(document.documentElement,this.busyFlagClassName);const e=document.createElement("div");e.id=this.options.wrapperSelectorId,e.innerHTML=this.template;const i=e.querySelector(this.barSelector),c=t?"-100":u(this.status||0),o=typeof this.options.appendTo=="string"?document.querySelector(this.options.appendTo):this.options.appendTo;if(h(i,{transition:"all 0 linear",transform:`translate3d(${c}%, 0, 0)`}),!this.options.showSpinner){const d=e.querySelector(this.spinnerSelector);d&&T(d)}return o!=document.body&&S(o,this.customParentClassName),o&&o.appendChild(e),e}set(t){const e=this.isStarted();t=n(t,this.options.minimum,1),this.status=t===1?null:t;const i=this.render(!e),c=i.querySelector(this.barSelector),o=this.options.speed,d=this.options.easing;return this.progressOffsetWidth=i.offsetWidth,k(a=>{this.positionUsing===""&&(this.positionUsing=this.getPositioningCSS()),h(c,this.barPositionCSS(t,o,d)),t===1?(h(i,{transition:"none",opacity:1}),this.progressOffsetWidth=i.offsetWidth,setTimeout(()=>{h(i,{transition:`all ${o}ms linear`,opacity:0}),setTimeout(()=>{this.remove(),a()},o)},o)):setTimeout(a,o)}),this}inc(t){let e=this.status;return e?e>1?this:(typeof t!="number"&&(e>=0&&e<.2?t=.1:e>=.2&&e<.5?t=.04:e>=.5&&e<.8?t=.02:e>=.8&&e<.99?t=.005:t=0),e=n(e+t,0,.994),this.set(e)):this.start()}trickle(){return this.inc()}start(){this.status||this.set(0);const t=()=>{setTimeout(()=>{this.status&&(this.trickle(),t())},this.options.trickleSpeed)};return this.options.trickle&&t(),this}done(t){var e;return!t&&!this.status?this:(e=this.inc(.3+.5*Math.random()))==null?void 0:e.set(1)}remove(){b(document.documentElement,this.busyFlagClassName);const t=typeof this.options.appendTo=="string"?document.querySelector(this.options.appendTo):this.options.appendTo;b(t,this.customParentClassName);const e=document.getElementById(this.options.wrapperSelectorId);e&&T(e)}isRendered(){return!!document.getElementById(this.options.wrapperSelectorId)}isStarted(){return typeof this.status=="number"}barPositionCSS(t,e,i){let c={};return this.positionUsing==="translate3d"?c={transform:`translate3d(${u(t)}%,0,0)`}:this.positionUsing==="translate"?c={transform:`translate(${u(t)}%,0)`}:c={"margin-left":`${u(t)}%`},c.transition=`all ${e}ms ${i} 0s`,c}getPositioningCSS(){const t=document.body.style,e="WebkitTransform"in t?"Webkit":"MozTransform"in t?"Moz":"msTransform"in t?"ms":"OTransform"in t?"O":"";return e+"Perspective"in t?"translate3d":e+"Transform"in t?"translate":"margin"}static createProgress(t){return p.instance||(p.instance=new p(t)),p.instance}};let f=p;l(f,"instance");const C=function(s){return f.createProgress(s)},I="";r.Trickling=f,r.createTrickling=C,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
