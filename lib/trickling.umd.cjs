(function(n,r){typeof exports=="object"&&typeof module!="undefined"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis!="undefined"?globalThis:n||self,r(n.Trickling={}))})(this,function(n){"use strict";var T=Object.defineProperty;var x=(n,r,h)=>r in n?T(n,r,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[r]=h;var u=(n,r,h)=>(x(n,typeof r!="symbol"?r+"":r,h),h);function r(s,e,t){return s<e?e:s>t?t:s}function h(s,e){return(e?(1-s)*100:(-1+s)*100).toFixed(4)}const v=(()=>{const s=[];function e(){const t=s.shift();t&&t(e)}return function(t){s.push(t),s.length==1&&e()}})();function g(s,e){const i=(s.getAttribute("style")||"").split(";").filter(a=>!!a.trim()).reduce((a,f)=>{const E=f.split(":").map(C=>C.trim()),W=E[0],B=E[1];return a[W]=B,a},{}),c=Object.assign(i,e),P=Object.keys(c).filter(a=>!!a.trim()).reduce((a,f)=>(a+=`${f}: ${c[f]};`,a),"");s.setAttribute("style",P)}function m(s,e){const t=typeof e=="string"?[e]:e;s.classList.add(...t)}function k(s,e){const t=typeof e=="string"?[e]:e;s.classList.remove(...t)}function b(s){s&&s.parentNode&&s.parentNode.removeChild(s)}var l=(s=>(s.wrapperSelectorId="trickling",s.customParentClassName="trickling-custom-parent",s.busyFlagClassName="trickling-busy",s.template=`
  <div class="trickling-progress-bar" role="bar">
    <div class="trickling-progress-peg"></div>
  </div>
  <div class="trickling-progress-spinner" role="spinner">
    <div class="trickling-progress-spinner__spinner-icon"></div>
  </div>`,s.barSelector='[role="bar"]',s.spinnerSelector='[role="spinner"]',s.rtlClassName="rtl",s))(l||{}),y=(s=>(s.queryBarElementError="[Trickling]: Can not find 'barSelector' element!",s.queryAppendToElementError="[Trickling]: Can not find 'options.appendTo' element!",s))(y||{});const p=class{constructor(e){u(this,"status",null);u(this,"positionUsing","");u(this,"options",{speed:200,easing:"ease",appendTo:"body",customWrapperClassName:"",minimum:.08,maximum:.994,showSpinner:!0,trickleSpeed:1e3,trickle:!0,color:"#2299dd",progressBarHeight:"2px",spinnerOpacity:1,spinnerSize:"18px",spinnerStrokeWidth:"2px",zIndex:1031,rtl:!1,removeFromDOMWhenDone:!0});this.options=Object.assign(this.options,e),this.setPercent(null)}setOptions(e){return this.options=Object.assign(this.options,e),this}setCSSVars(e){g(e,{"--trickling-color":this.options.color,"--trickling-progress-bar-height":this.options.progressBarHeight,"--trickling-spinner-opacity":this.options.spinnerOpacity,"--trickling-spinner-size":this.options.spinnerSize,"--trickling-spinner-stroke-width":this.options.spinnerStrokeWidth,"--trickling-progress-bar-z-index":this.options.zIndex})}render(e){if(this.isRendered())return this.getWrapperElement();m(document.documentElement,l.busyFlagClassName);const t=document.createElement("div");t.id=l.wrapperSelectorId,t.innerHTML=l.template,this.options.rtl&&m(t,l.rtlClassName),this.options.customWrapperClassName&&m(t,this.options.customWrapperClassName),this.setCSSVars(t);const o=this.getBarElement(t),i=this.getAppendToElement();if(this.translateProgressBar(o,e),!this.options.showSpinner){const c=t.querySelector(l.spinnerSelector);c&&b(c)}return i!=document.body&&m(i,l.customParentClassName),i&&i.appendChild(t),t}triggerRepaint(){const e=this.getWrapperElement();e&&(p.progressOffsetWidth=e.offsetWidth)}set(e){const t=this.isStarted();!t&&this.visible(),e=r(e,this.options.minimum,1),this.setPercent(e===1?null:e);const o=this.render(!t),i=this.getBarElement(o),c=this.options.speed,P=this.options.easing;return this.triggerRepaint(),v(a=>{this.positionUsing===""&&(this.positionUsing=this.getPositioningCSS()),g(i,this.barPositionCSS(e,c,P)),e===1?(g(o,{transition:"none",opacity:1}),this.triggerRepaint(),setTimeout(()=>{g(o,{transition:`all ${c}ms linear`,opacity:0}),setTimeout(()=>{this.remove(),a()},c)},c)):setTimeout(a,c)}),this}inc(e){let t=this.getPercent();return t?t>1?this:(typeof e!="number"&&(t>=0&&t<.2?e=.1:t>=.2&&t<.5?e=.04:t>=.5&&t<.8?e=.02:t>=.8&&t<.99?e=.005:e=0),t=r(t+e,0,this.options.maximum),this.set(t)):this.start()}trickle(){return this.inc()}start(){!this.isStarted()&&this.visible(),this.getPercent()||this.set(0);const e=()=>{setTimeout(()=>{this.getPercent()&&(this.trickle(),e())},this.options.trickleSpeed)};return this.options.trickle&&e(),this}done(e){return!e&&!this.getPercent()?this:this.inc(.3+.5*Math.random()).set(1)}translateProgressBar(e,t){const o=t?this.getBarPercentage(0):this.getBarPercentage(this.getPercent()||0);g(e,{transition:"all 0 linear",transform:`translate3d(${o}%, 0, 0)`})}visible(){if(this.isRendered()&&!this.options.removeFromDOMWhenDone){const e=this.getWrapperElement();e&&g(e,{display:"block",opacity:1}),this.setPercent(null)}}hidden(){const e=this.getWrapperElement();e&&(g(e,{display:"none"}),this.setPercent(null),this.translateProgressBar(this.getBarElement(e),!0))}remove(e){if(k(document.documentElement,l.busyFlagClassName),!this.options.removeFromDOMWhenDone&&!e){this.hidden();return}const t=this.getAppendToElement();k(t,l.customParentClassName);const o=this.getWrapperElement();o&&b(o)}getWrapperElement(){return document.getElementById(l.wrapperSelectorId)}getBarElement(e){const t=e.querySelector(l.barSelector);if(!t)throw new Error(y.queryBarElementError);return t}getAppendToElement(){const e=typeof this.options.appendTo=="string"?document.querySelector(this.options.appendTo):this.options.appendTo;if(!e)throw new Error(y.queryAppendToElementError);return e}setPercent(e){this.status=e}getPercent(){return this.status}isRendered(){return!!this.getWrapperElement()}isStarted(){return typeof this.getPercent()=="number"}getBarPercentage(e){return h(e,this.options.rtl)}barPositionCSS(e,t,o){let i={};return this.positionUsing==="translate3d"?i={transform:`translate3d(${this.getBarPercentage(e)}%,0,0)`}:this.positionUsing==="translate"?i={transform:`translate(${this.getBarPercentage(e)}%,0)`}:i={"margin-left":`${this.getBarPercentage(e)}%`},i.transition=`all ${t}ms ${o} 0s`,i}getPositioningCSS(){const e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"}static createProgress(e){return p.instance||(p.instance=new p(e)),p.instance}};let d=p;u(d,"instance"),u(d,"progressOffsetWidth",0);const S=function(s){return d.createProgress(s)},M="";n.Trickling=d,n.createTrickling=S,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
