(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.Trickling={}))})(this,function(n){"use strict";var C=Object.defineProperty;var w=(n,i,p)=>i in n?C(n,i,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[i]=p;var l=(n,i,p)=>(w(n,typeof i!="symbol"?i+"":i,p),p);function i(s,e,t){return s<e?e:s>t?t:s}function p(s){return((-1+s)*100).toFixed(4)}const b=(()=>{const s=[];function e(){const t=s.shift();t&&t(e)}return function(t){s.push(t),s.length==1&&e()}})();function f(s,e){const c=(s.getAttribute("style")||"").split(";").filter(o=>!!o.trim()).reduce((o,m)=>{const k=m.split(":").map(E=>E.trim()),P=k[0],v=k[1];return o[P]=v,o},{}),r=Object.assign(c,e),h=Object.keys(r).filter(o=>!!o.trim()).reduce((o,m)=>(o+=`${m}: ${r[m]};`,o),"");s.setAttribute("style",h)}function g(s,e){const t=typeof e=="string"?[e]:e;s.classList.add(...t)}function y(s,e){const t=typeof e=="string"?[e]:e;s.classList.remove(...t)}function S(s){s&&s.parentNode&&s.parentNode.removeChild(s)}const d=class{constructor(e){l(this,"template",`
    <div class="bar" role="bar">
      <div class="peg"></div>
    </div>
    <div class="spinner" role="spinner">
      <div class="spinner-icon"></div>
    </div>`);l(this,"barSelector",'[role="bar"]');l(this,"spinnerSelector",'[role="spinner"]');l(this,"busyFlagClassName","trickling-busy");l(this,"customParentClassName","trickling-custom-parent");l(this,"status",null);l(this,"positionUsing","");l(this,"options",{speed:200,wrapperSelectorId:"trickling",appendTo:"body",minimum:.08,easing:"ease",showSpinner:!0,trickleSpeed:1e3,trickle:!0,color:"#29d",progressBarHeight:"2px",spinnerOpacity:1,spinnerSize:"18px",spinnerStrokeWidth:"2px"});this.options=Object.assign(this.options,e),this.setPercent(null)}setStyleVars(e){f(e,{"--trickling-color":this.options.color,"--trickling-progress-bar-height":this.options.progressBarHeight,"--trickling-spinner-opacity":this.options.spinnerOpacity,"--trickling-spinner-size":this.options.spinnerSize,"--trickling-spinner-stroke-width":this.options.spinnerStrokeWidth})}render(e){if(this.isRendered())return document.getElementById(this.options.wrapperSelectorId);g(document.documentElement,this.busyFlagClassName);const t=document.createElement("div");t.id=this.options.wrapperSelectorId,t.innerHTML=this.template,this.setStyleVars(t);const a=this.getBarElement(t),c=e?"-100":p(this.getPercent()||0),r=this.getAppendToElement();if(f(a,{transition:"all 0 linear",transform:`translate3d(${c}%, 0, 0)`}),!this.options.showSpinner){const h=t.querySelector(this.spinnerSelector);h&&S(h)}return r!=document.body&&g(r,this.customParentClassName),r&&r.appendChild(t),t}set(e){const t=this.isStarted();e=i(e,this.options.minimum,1),this.setPercent(e===1?null:e);const a=this.render(!t),c=this.getBarElement(a),r=this.options.speed,h=this.options.easing;return d.progressOffsetWidth=a.offsetWidth,b(o=>{this.positionUsing===""&&(this.positionUsing=this.getPositioningCSS()),f(c,this.barPositionCSS(e,r,h)),e===1?(f(a,{transition:"none",opacity:1}),d.progressOffsetWidth=a.offsetWidth,setTimeout(()=>{f(a,{transition:`all ${r}ms linear`,opacity:0}),setTimeout(()=>{this.remove(),o()},r)},r)):setTimeout(o,r)}),this}inc(e){let t=this.getPercent();return t?t>1?this:(typeof e!="number"&&(t>=0&&t<.2?e=.1:t>=.2&&t<.5?e=.04:t>=.5&&t<.8?e=.02:t>=.8&&t<.99?e=.005:e=0),t=i(t+e,0,.994),this.set(t)):this.start()}trickle(){return this.inc()}start(){this.getPercent()||this.set(0);const e=()=>{setTimeout(()=>{this.getPercent()&&(this.trickle(),e())},this.options.trickleSpeed)};return this.options.trickle&&e(),this}done(e){return!e&&!this.getPercent()?this:this.inc(.3+.5*Math.random()).set(1)}remove(){y(document.documentElement,this.busyFlagClassName);const e=this.getAppendToElement();y(e,this.customParentClassName);const t=document.getElementById(this.options.wrapperSelectorId);t&&S(t)}getBarElement(e){const t=e.querySelector(this.barSelector);if(!t)throw new Error("[Trickling]: Can not find 'barSelector' element!");return t}getAppendToElement(){const e=typeof this.options.appendTo=="string"?document.querySelector(this.options.appendTo):this.options.appendTo;if(!e)throw new Error("[Trickling]: Can not find 'options.appendTo' element!");return e}setPercent(e){this.status=e}getPercent(){return this.status}isRendered(){return!!document.getElementById(this.options.wrapperSelectorId)}isStarted(){return typeof this.getPercent()=="number"}barPositionCSS(e,t,a){let c={};return this.positionUsing==="translate3d"?c={transform:`translate3d(${p(e)}%,0,0)`}:this.positionUsing==="translate"?c={transform:`translate(${p(e)}%,0)`}:c={"margin-left":`${p(e)}%`},c.transition=`all ${t}ms ${a} 0s`,c}getPositioningCSS(){const e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"}static createProgress(e){return d.instance||(d.instance=new d(e)),d.instance}};let u=d;l(u,"instance"),l(u,"progressOffsetWidth",0);const T=function(s){return u.createProgress(s)},B="";n.Trickling=u,n.createTrickling=T,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
